<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="ServiciosDeGranalladoFacturado_TOTAL" pageWidth="572" pageHeight="752" columnWidth="572" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="2f73af3b-3206-48bb-8342-1000713d0fea">
	<property name="ireport.zoom" value="1.366026910730141"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="fecha_Desde" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="fecha_Hasta" class="java.util.Date">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="PComision" class="java.lang.Double">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="parameter1" class="java.lang.String"/>
	<parameter name="PAComisionar" class="java.lang.Double"/>
	<parameter name="PTOTALCOMISION" class="java.lang.Double"/>
	<queryString>
		<![CDATA[select
ot.orden_nro,
ot.fecha as fecha_ot,
ot.prioridad_id,
ot.fecha_inicio,
ot.fecha_fin,
ot.cliente_id,
ot.anticipo,
cli.nombre,
odt.orden_detalle_id,
se.servicio,
art.descripcion,
fa.fecha_emision as fecha_emision,
fa.nro_presupuesto as nro_comprobante,
fa.fecha_vencimiento as fecha_comprobante,
fa.tipo_presupuesto as tipo_comprobante,
'PRESUPUESTO' as forma_comprobante,
odt.total,


CASE se.servicio
WHEN 'PINTURA' then odt.total * $P{PAComisionar} /100
ELSE  odt.total END
as totalacomisionar
,

CASE se.servicio
WHEN 'PINTURA' then (odt.total * $P{PAComisionar}/100) * $P{PComision} / 100
WHEN 'GRANALLADO' then (odt.total * $P{PComision}/100) END
as comision



 from ordenes_trabajo as ot
inner join cliente as cli ON (ot.cliente_id = cli.cliente_id)
inner join  orden_trabajo_detalle  as odt ON (ot.orden_id = odt.orden_id)
inner join presupuesto as fa ON (ot.orden_nro = fa.orden)
inner join servicios as se ON (odt.servicio_id = se.servicio_id)
inner join articulos as art ON (odt.articulo_id = art.articulo_id)
where odt.granallado= true
and (fecha_emision::date  between $P{fecha_Desde} AND  $P{fecha_Hasta})
and ot.estado_id =5
and fa.estado_financiero !=2

GROUP BY
ot.orden_nro,
ot.fecha,
ot.prioridad_id,
ot.fecha_inicio,
ot.fecha_fin,
ot.cliente_id,
ot.anticipo,
cli.nombre,
odt.orden_detalle_id,
se.servicio,
art.descripcion,
fa.fecha_emision,
fa.nro_presupuesto ,
fa.fecha_vencimiento,
fa.tipo_presupuesto,
odt.total


UNION


select
ot.orden_nro,
ot.fecha as fecha_ot,
ot.prioridad_id,
ot.fecha_inicio,
ot.fecha_fin,
ot.cliente_id,
ot.anticipo,
cli.nombre,
odt.orden_detalle_id,
se.servicio,
art.descripcion,
fa.fecha_emision as fecha_emision,
fa.nro_factura as nro_comprobante,
fa.fecha_vencimiento as fecha_comprobante,
fa.tipo_factura as tipo_comprobante,
'FACTURA' as forma_comprobante,
odt.total,

CASE se.servicio
WHEN 'PINTURA' then odt.total * $P{PAComisionar} /100
ELSE  odt.total END
as totalacomisionar
,

CASE se.servicio
WHEN 'PINTURA' then (odt.total * $P{PAComisionar}/100) * $P{PComision} / 100
WHEN 'GRANALLADO' then (odt.total * $P{PComision}/100) END
as comision


 from ordenes_trabajo as ot
inner join cliente as cli ON (ot.cliente_id = cli.cliente_id)
inner join  orden_trabajo_detalle  as odt ON (ot.orden_id = odt.orden_id)
inner join facturas as fa ON (ot.orden_nro = fa.orden)
inner join servicios as se ON (odt.servicio_id = se.servicio_id)
inner join articulos as art ON (odt.articulo_id = art.articulo_id)
where odt.granallado= true
and (fecha_emision::date  between $P{fecha_Desde} AND $P{fecha_Hasta})
and ot.estado_id =5
and fa.estado_financiero !=2




GROUP BY
ot.orden_nro,
ot.fecha,
ot.prioridad_id,
ot.fecha_inicio,
ot.fecha_fin,
ot.cliente_id,
ot.anticipo,
cli.nombre,
odt.orden_detalle_id,
se.servicio,
art.descripcion,
fa.fecha_emision,
fa.nro_factura ,
fa.fecha_vencimiento,
fa.tipo_factura,
odt.total

order by  fecha_ot, cliente_id]]>
	</queryString>
	<field name="orden_nro" class="java.lang.Integer"/>
	<field name="fecha_ot" class="java.sql.Date"/>
	<field name="prioridad_id" class="java.lang.Integer"/>
	<field name="fecha_inicio" class="java.sql.Date"/>
	<field name="fecha_fin" class="java.sql.Date"/>
	<field name="cliente_id" class="java.lang.Integer"/>
	<field name="anticipo" class="java.lang.Double"/>
	<field name="nombre" class="java.lang.String"/>
	<field name="orden_detalle_id" class="java.lang.Integer"/>
	<field name="servicio" class="java.lang.String"/>
	<field name="descripcion" class="java.lang.String"/>
	<field name="fecha_emision" class="java.sql.Timestamp"/>
	<field name="nro_comprobante" class="java.lang.String"/>
	<field name="fecha_comprobante" class="java.sql.Date"/>
	<field name="tipo_comprobante" class="java.lang.String"/>
	<field name="forma_comprobante" class="java.lang.String"/>
	<field name="total" class="java.math.BigDecimal"/>
	<field name="totalacomisionar" class="java.lang.Double"/>
	<field name="comision" class="java.lang.Double"/>
	<variable name="total_1" class="java.math.BigDecimal" resetType="Column" calculation="Lowest">
		<variableExpression><![CDATA[$F{total}]]></variableExpression>
	</variable>
	<variable name="total_2" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{totalacomisionar}]]></variableExpression>
	</variable>
	<variable name="comision_1" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{comision}]]></variableExpression>
	</variable>
	<variable name="TotalComision" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{comision}]]></variableExpression>
	</variable>
	<variable name="variable1" class="java.lang.String"/>
	<variable name="comision_2" class="java.lang.Double" calculation="Sum">
		<variableExpression><![CDATA[$F{comision}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band height="35" splitType="Prevent">
			<staticText>
				<reportElement x="1" y="15" width="48" height="20" forecolor="#0A0909" uuid="229910a5-8651-4d03-b5b0-74aba82ba668"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[Factura#]]></text>
			</staticText>
			<staticText>
				<reportElement x="49" y="15" width="51" height="20" forecolor="#0A0909" uuid="0898cad7-0401-46fe-95c9-fe1383511867"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[Orden]]></text>
			</staticText>
			<staticText>
				<reportElement x="100" y="15" width="55" height="20" forecolor="#0A0909" uuid="cf94bc1a-1a4f-476a-a0c5-831eff96578c"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[Fecha]]></text>
			</staticText>
			<staticText>
				<reportElement x="437" y="15" width="59" height="20" forecolor="#0A0909" uuid="903294fa-f7c4-46de-8328-16c9badc26c1"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[     Total]]></text>
			</staticText>
			<staticText>
				<reportElement x="155" y="15" width="106" height="20" forecolor="#0A0909" uuid="50e7233b-53db-471d-b2bc-7cc8d172d771"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[           Cliente]]></text>
			</staticText>
			<staticText>
				<reportElement x="261" y="15" width="80" height="20" forecolor="#0A0909" uuid="9f0318b3-5f72-431b-b305-691a3c6a6942"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[       Servicio]]></text>
			</staticText>
			<staticText>
				<reportElement x="341" y="15" width="96" height="20" forecolor="#0A0909" uuid="465c60b1-561b-4c44-929e-51b0f6f58365"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="8" isBold="true" isItalic="false"/>
				</textElement>
				<text><![CDATA[       Articulo]]></text>
			</staticText>
			<staticText>
				<reportElement x="496" y="15" width="77" height="20" uuid="5b9700d1-0a84-4dc0-ae5d-c243514ebdb8"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[Comprobante]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="21" splitType="Stretch">
			<textField>
				<reportElement x="497" y="0" width="76" height="20" uuid="1d85695b-03df-48fe-8ff5-a8b9d6b25d35"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="5" isBold="false"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{forma_comprobante}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="1" y="0" width="48" height="20" uuid="90d43d25-be9c-4523-923a-7172dd6b8ee6"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nro_comprobante}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="49" y="0" width="51" height="20" uuid="9bdc5191-1cae-4563-96c5-3eb4b895832b"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{orden_nro}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="100" y="0" width="55" height="20" uuid="0029327b-ee45-4214-a6f7-a16dc29bd380"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{fecha_emision}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="155" y="0" width="106" height="20" uuid="baa9f2a1-e12a-4f2e-bbfc-556b36d2dd00"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{nombre}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="261" y="0" width="80" height="20" uuid="a5bf98ce-dd35-4020-bafa-45964080c929"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{servicio}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="341" y="0" width="96" height="20" uuid="8a896a43-b7cb-474f-bd34-1cc91d12b1be"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement verticalAlignment="Middle">
					<font fontName="Arial" size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{descripcion}]]></textFieldExpression>
			</textField>
			<textField pattern="#,##0">
				<reportElement x="437" y="0" width="59" height="20" uuid="7975b2b9-747a-46db-bf77-272309f6a4bd"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="5"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{totalacomisionar}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<summary>
		<band height="93" splitType="Stretch">
			<staticText>
				<reportElement x="360" y="0" width="100" height="20" forecolor="#0A0909" uuid="bb757d6f-5a06-43ab-91cf-c2c655d63d7d"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total Servicio:]]></text>
			</staticText>
			<textField pattern="#,##0">
				<reportElement x="460" y="0" width="100" height="20" uuid="25113242-04ee-47d1-b7e4-f061f5e653f1"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{total_2}]]></textFieldExpression>
			</textField>
			<textField evaluationTime="Report" pattern="#,##0" isBlankWhenNull="true">
				<reportElement x="460" y="35" width="100" height="20" uuid="c30c259d-0df1-4d16-b533-791f7851bcc0"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA[$V{TotalComision}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="360" y="35" width="100" height="20" forecolor="#0A0909" uuid="3b80ebde-90bd-45c4-af0a-549d97dba691"/>
				<box>
					<topPen lineWidth="1.0"/>
					<leftPen lineWidth="1.0"/>
					<bottomPen lineWidth="1.0"/>
					<rightPen lineWidth="1.0"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[Total Comision:]]></text>
			</staticText>
		</band>
	</summary>
</jasperReport>
